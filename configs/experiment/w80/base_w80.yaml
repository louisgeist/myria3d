# @package _global_

# Nota : call "python myria3d/pctl/dataset/toy_dataset.py" to create a toy dataset before running this.
defaults:
  - override /model: pyg_randla_net_model.yaml
  - override /datamodule/transforms/augmentations: light.yaml
  - override /logger: wandb.yaml
  - override /dataset_description: flair3d_lvl1.yaml
  - override /datamodule/transforms/preparations: points_budget_flair3d.yaml

model:
  criterion:
    ignore_index: 3 # num_classes - 1
  
  monitor: "val/iou"

callbacks:
  model_checkpoint:
    monitor: ${model.monitor}
    mode: "max"

  early_stopping:
    monitor: ${model.monitor}
    mode: "max"

logger:
  wandb:
    name: >
      RandLaNet | label=${datamodule.transforms.preparations.y_definition} | 
      voxel=${datamodule.transforms.preparations.voxel}

trainer:
  min_epochs: 100
  max_epochs: 150
  num_sanity_val_steps: 2
  accelerator: gpu
  

datamodule:
  _target_: myria3d.pctl.datamodule.hdf5.Flair3DDatamodule
  batch_size: 12
  num_workers: 2
  # runtime.cwd is where application is run from e.g. where run.py is.
  data_dir: "${hydra:runtime.cwd}/tests/data/"
  split_csv_path: "${hydra:runtime.cwd}/tests/data/flair3d_split.csv"
  hdf5_file_path: "${hydra:runtime.cwd}/tests/data/flair3d.hdf5" # PATH FOR NEW HDF5 PATH

  points_pre_transform:
    _target_: functools.partial
    _args_:
      - "${get_method:myria3d.pctl.dataset.flair3d.flair3d_pre_transform}"

  tile_width: 100